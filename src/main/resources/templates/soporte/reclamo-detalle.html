<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle reclamo</title>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/layout.css">
</head>
<body>
  <header class="header" id="navbar"></header>
  <main class="main container">
    <div id="reclamo-detalle"></div>
  </main>
  <script type="module">
    import { reclamosApi } from '/js/api/reclamosApi.js';
    import { authGuard } from '/js/utils/auth.js';
    import { renderNavbar, showToast } from '/js/utils/ui.js';
    authGuard(['soporte']);
    renderNavbar('/soporte/reclamo-detalle');
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const container = document.getElementById('reclamo-detalle');
    async function load() {
      if (!id) { container.innerHTML = '<div class="alert">Reclamo no encontrado</div>'; return; }
      try {
        const r = await reclamosApi.detail(id);
        container.innerHTML = `
          <div class="card">
            <div class="flex" style="justify-content: space-between; align-items:center;">
              <div>
                <h1>Reclamo #${r.id}</h1>
                <div class="text-muted">Pedido #${r.pedidoId} Â· Cliente ${r.clienteNombre || ''}</div>
              </div>
              <span class="badge">${r.estado}</span>
            </div>
            <p>${r.descripcion}</p>
            <button class="button" id="marcar-resuelto">Marcar resuelto</button>
          </div>`;
        document.getElementById('marcar-resuelto').onclick = async () => {
          await reclamosApi.updateEstado(id, 'RESUELTO');
          showToast('Estado actualizado');
          load();
        };
      } catch (err) {
        container.innerHTML = `<div class="alert">${err.message}</div>`;
      }
    }
    load();
  </script>
</body>
</html>
